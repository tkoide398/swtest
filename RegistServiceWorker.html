<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="manifest" href="/swtest/manifest.json"/>
    <title></title>
</head>






<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-messaging.js"></script>


<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAvqXnkledWUrjRh95WKEDEbYCUe5ETM54",
    authDomain: "swtest-2ec14.firebaseapp.com",
    projectId: "swtest-2ec14",
    storageBucket: "swtest-2ec14.appspot.com",
    messagingSenderId: "717284539943",
    appId: "1:717284539943:web:c35262f0bb6629e62f1802"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
</script>





<body>
    Test page<br>
    ServiceWorker doesn't work yet.
</body>


<script type="text/javascript">

    if ('serviceWorker' in navigator) {
        // serviceworkerの登録
        navigator.serviceWorker.register('/swtest/firebase-messaging-sw.js');

const messaging = firebase.messaging();
Notification.requestPermission().then((permission) => {
  if (permission === 'granted') {
    // 通知を許可した場合
    console.log('Notification permission granted.');

    messaging.getToken().then((currentToken) => {
      if (currentToken) {
        // トークン取得成功
        console.log("currentToken:");
        console.log(currentToken);
      } else {
        // トークン取得失敗
      }
    });
  } else {
    // 通知を拒否した場合
    console.log('Unable to get permission to notify.');
  }
});


//    if ('serviceWorker' in navigator) {
//        // serviceworkerの登録
//        navigator.serviceWorker.register('/swtest/serviceworker.js');

//        navigator.serviceWorker.ready
//            .then(function (registration) {
//                // pushの登録
//                console.log("show subscribe")
//                return registration.pushManager.subscribe({ userVisibleOnly: true }); 
//            })
//            .then(function (subscription) {
//                console.log("subscription done");
//                console.log(subscription);
//                console.log('GCM EndPoint is:' + subscription.endpoint);
//                var auth = subscription.getKey('auth') ? btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('auth')))) : '';
//                console.log('User Auth is:' + auth);
//                var publicKey = subscription.getKey('p256dh') ? btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('p256dh')))) : '';
//                console.log('User PublicKey is:' + publicKey);
//            })
//            .catch(function (err) {
//                console.log("error"); 
//                console.error.bind(console);
//            } );
    }
</script>




</html>
